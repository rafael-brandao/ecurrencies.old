ext {
	javaMarkup = [
		'src/main/java',
		'src/main/resources',
		'src/test/java',
		'src/test/resources'
	]
	scalaMarkup = [
		'src/main/scala',
		'src/test/scala'
	]
	protobufMarkup = /^.+\.proto$/
}

def anySubdirectoryExists(project, list) {
	list.any {
		file("${project.projectDir}/${it}").isDirectory()
	}
}

def isScalaProject(project) {
	anySubdirectoryExists(project, scalaMarkup )
}

def isJavaProject(project) {
	anySubdirectoryExists(project, javaMarkup )
}

subprojects.findAll {
	it.childProjects.size() == 0
}.each {
	def protobufFiles = it.projectDir.listFiles({ f ->f ==~ protobufMarkup } as FileFilter).toList()
	def protobufProject = protobufFiles.size() > 0
	def scalaProject = isScalaProject(it)
	def javaProject = 	isJavaProject(it) || protobufProject || scalaProject

	if(protobufProject) {
		protobufProjects.push it
		it.ext.protobufFiles = protobufFiles
	}
	if(scalaProject) scalaProjects.push it
	if(javaProject ) javaProjects.push it
}
subprojects {
    sourceSets { protobuf }
    task compileProtobuf(type:Exec) {
        doFirst {
            sourceSets.protobuf.java.srcDirs.each {it.mkdirs()}
            sourceSets.protobuf.resources.srcDirs.each {it.mkdirs()}
        }
        sourceSets.main.output.classesDir.mkdirs()
        executable "protoc"
        args "-I=${projectDir}",
                "--descriptor_set_out=${sourceSets.protobuf.resources}/domain.descriptor",
                "--java_out=${sourceSets.protobuf.java}",
                "${projectDir}/domain.proto"
    }
    compileJava.dependsOn('compileProtobuf')
}